<html>
<head>
  <title>wtmoo metasearch</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      font-family: 'FantasqueSansMono NF', 'JetBrains Mono', 'Fira Code', Consolas, monospace;
    }

    body {
      display: flex;
      flex-flow: column nowrap;
    }
    
    #title {
      font-size: 500%;
    }

    #searchbar {
      width: 60%; display: flex;
    }
    
    input { font-size: 200%; font-family: 'FantasqueSansMono NF', 'JetBrains Mono', 'Fira Code', Consolas, monospace; border: 1px solid #888; padding: 0 6px; }
    #bang.error { background-color: #fbb; }
    #bang { background-color: #eee; text-align: right; width: 20%; border-radius: 5px 0 0 5px; } #query { width: 80%; border-left: none; border-radius: 0 5px 5px 0; }
  </style>
</head>
<body>
  <center>
    <h1 id="title">!wtmoo</h1>
    <form id="searchbar">
      <input type="text" id="bang" value="!g">
      <input type="text" id="query" placeholder="search here">
    </form>
  </center>
  <script>
    const engines = $;
    const engined = {};
    const engineList = [];
    const engineBangs = [];
    for (const [aliases, url] of engines) { engineList.push(aliases[0]); for (const alias of aliases) { engined[alias] = url; engineBangs.push(alias, url); } }
    
    let bang = document.getElementById('bang'),
      query = document.getElementById('query');
    query.focus();
    function onBangKeydown(e) {
      switch (e.key) {
        case ' ':
          query.focus(); query.selectionStart = 0; query.value = '';
          e.preventDefault();
          e.stopPropagation();
          break;
      }
    }
    function onBangKeyup(e) {
      if (e.ctrlKey || e.altKey || e.shiftKey) { return; }
      if (bang.value.length === 0) {
        bang.value = '!';
      }
      if (bang.value.slice(1) in engined) { bang.classList.remove('error'); } else { bang.classList.add('error'); }
    }
    function onBangFocusout(e) {
      if (bang.value.slice(1) in engined) { bang.classList.remove('error'); } else { bang.classList.add('error'); }
    }
    function onQueryKeydown(e) {
      if (e.ctrlKey || e.altKey || e.shiftKey) { return; }
      switch (e.key) {
        case 'Backspace':
          if (query.value.length === 0) {
            bang.focus(); bang.selectionStart = bang.value.length;
            e.preventDefault();
            e.stopPropagation();
          }
          break;
      }
    }
    bang.addEventListener('keydown', onBangKeydown);
    bang.addEventListener('keyup', onBangKeyup);
    bang.addEventListener('focusout', onBangFocusout);
    query.addEventListener('keydown', onQueryKeydown);
  </script>
</body>
</html>